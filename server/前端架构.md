# 前端架构

## 技术栈
- React 19 + TypeScript + Vite（`@vitejs/plugin-react-swc`）
- 文件路由：TanStack Router（`routeTree.gen.ts` 自动生成）
- 数据层：TanStack Query（全局错误处理）、Axios（`services/config.ts`）
- 状态：Zustand（`stores/auth-store.ts`）
- UI：Tailwind CSS v4 + shadcn/ui（`components.json`），lucide 图标，sonner 提示

## 目录结构（web/src）
- `routes/`：文件路由，分区块 `(auth)`, `(errors)`, `_authenticated`（守卫见 `_authenticated/route.tsx`）
- `features/`：按功能域拆分（system/users、roles、menus 等）
- `components/`：UI 组件与布局（`components/layout/*`，`AppSidebar`）
- `services/`：API 调用封装（Auth/Profile/Menu/Role/User 等）
- `context/`：主题、字体、布局、搜索 Provider
- `stores/`：全局状态（认证、权限）
- `lib/`：工具与适配器（`backend-menu-adapter.ts`）

## 路由与布局
- 根路由在 `routes/__root.tsx`，注入导航进度与 DevTools。
- 认证区块 `_authenticated` 在 `beforeLoad` 中校验 `accessToken`，无效时重定向至 `/sign-in`。
- 布局：`AuthenticatedLayout` 使用 `SidebarProvider` 和 `AppSidebar` 渲染左侧导航。

## 数据请求与状态
- Axios `apiClient` 基于 `window.location`，自动注入 `Authorization: Bearer <token>`。
- 开发代理：`vite.config.ts` 将 `/api`、`/share` 代理至 `http://localhost:55667`。
- TanStack Query：在 `main.tsx` 初始化，404/500/401 等通过 `QueryCache` 与 `handle-server-error` 统一处理；401 会重置登录并跳转。

## 权限与菜单
- 登录后 `auth-store` 持久化 `accessToken` 并轻量解析 JWT。
- 菜单/权限来自后台 `/api/v1/resources`：`menu-service` 请求并缓存，`backend-menu-adapter` 转为 `NavGroup`；`use-sidebar-data` 响应用户切换与手动刷新。
- 页面/按钮可用性通过 `auth-store` 的 `hasPermission/hasRole/canAccessMenu` 判定。

## 构建与生产
- 开发：`cd web && npm i && npm run dev`
- 构建：`npm run build` 输出至 `web/dist/`；后端通过 `web/web.go` 以 embed 方式提供静态资源。
